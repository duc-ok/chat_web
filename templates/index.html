<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chatbot Python</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #chatbox {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: scroll;
            margin-bottom: 20px;
        }
        #chatbox p {
            margin: 5px 0;
        }
        input, textarea, button {
            margin: 5px 0;
            padding: 5px;
        }
    </style>
</head>
<body>

<h1>💬 Chat với Python Bot</h1>

<div id="chatbox"></div>

<input type="text" id="question" placeholder="Nhập câu hỏi của bạn" style="width: 60%;">
<button onclick="guiCauHoi()">Gửi</button>

<hr>

<h2>🧠 Thêm kiến thức mới</h2>
<input type="text" id="y_dinh" placeholder="Ý định (vd: thời tiết)">
<br>
<textarea id="patterns" placeholder="Mẫu câu (mỗi mẫu 1 dòng)" rows="4" cols="50"></textarea>
<br>
<textarea id="responses" placeholder="Câu trả lời (mỗi câu 1 dòng)" rows="4" cols="50"></textarea>
<br>
<button onclick="themKienThuc()">Thêm kiến thức</button>

<p id="status"></p>

<script>
function themKienThuc() {
    const y_dinh = document.getElementById("y_dinh").value.trim();
    const patterns = document.getElementById("patterns").value.trim().split("\n");
    const responses = document.getElementById("responses").value.trim().split("\n");

    if (!y_dinh || patterns.length === 0 || responses.length === 0) {
        alert("Vui lòng nhập đầy đủ thông tin.");
        return;
    }

    fetch("/them_kienthuc", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            y_dinh: y_dinh,
            patterns: patterns,
            responses: responses
        })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("status").innerText = data.message;
    })
    .catch(err => {
        document.getElementById("status").innerText = "❌ Lỗi khi thêm kiến thức.";
    });
}

function guiCauHoi() {
    const cauHoi = document.getElementById("question").value;
    if (!cauHoi.trim()) return;

    fetch("/hoi", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ cau_hoi: cauHoi })
    })
    .then(res => res.json())
    .then(data => {
        const chatbox = document.getElementById("chatbox");
        chatbox.innerHTML += `<p><strong>Bạn:</strong> ${cauHoi}</p>`;
        chatbox.innerHTML += `<p><strong>Bot:</strong> ${data.tra_loi}</p>`;
        chatbox.scrollTop = chatbox.scrollHeight;
        document.getElementById("question").value = "";
    });
}
</script>

</body>
</html>
